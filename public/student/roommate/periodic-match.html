<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Periodic Match</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        body { font-family: 'Prompt', sans-serif; user-select: none; background-color: #f0fdf4; }
        .card { perspective: 1000px; cursor: pointer; height: 100px; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card.matched .card-inner { visibility: hidden; opacity: 0; transition: opacity 0.5s; }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 12px; font-weight: bold; }
        .card-front { background-color: #4ade80; color: white; font-size: 2rem; }
        .card-back { background-color: white; color: #15803d; transform: rotateY(180deg); border: 2px solid #4ade80; padding: 5px; word-break: break-all; }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen p-4">

    <!-- Start Screen -->
    <div id="start-screen" class="absolute inset-0 z-50 flex items-center justify-center bg-white/90 backdrop-blur-sm">
        <div class="text-center animate__animated animate__zoomIn p-6 max-w-sm">
            <div class="text-7xl mb-4">üß™</div>
            <h1 class="text-3xl font-bold text-green-700 mb-2">Periodic Match</h1>
            <p class="text-gray-500 mb-6">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà "‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå" ‡∏Å‡∏±‡∏ö "‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏≤‡∏ï‡∏∏" ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà!</p>
            <button onclick="startGame()" class="bg-green-600 hover:bg-green-700 text-white text-xl font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105">
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
            </button>
        </div>
    </div>

    <!-- UI -->
    <div class="flex justify-between w-full max-w-md mb-4 text-green-800">
        <div class="font-bold text-lg">‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="pairs-left">8</span></div>
        <div class="font-bold text-lg">‡πÄ‡∏ß‡∏•‡∏≤: <span id="timer" class="font-mono">0</span>s</div>
    </div>

    <!-- Game Grid -->
    <div id="game-grid" class="grid grid-cols-4 gap-3 w-full max-w-md">
        <!-- Cards generated by JS -->
    </div>

    <!-- End Screen -->
    <div id="end-screen" class="hidden absolute inset-0 z-50 flex items-center justify-center bg-white/90 backdrop-blur-sm">
        <div class="text-center animate__animated animate__fadeInUp p-6">
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="text-3xl font-bold text-gray-800">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</h2>
            <p class="text-gray-500 mb-2">‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏õ</p>
            <div class="text-5xl font-bold text-green-600 mb-6"><span id="final-time">0</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
            
            <button id="claim-btn" onclick="claimReward()" class="w-full bg-green-500 hover:bg-green-600 text-white text-lg font-bold py-3 rounded-xl shadow-lg mb-3">
                ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (+XP)
            </button>
            <button onclick="location.reload()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-3 rounded-xl">
                ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            </button>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏≤‡∏ï‡∏∏ (‡∏™‡∏∏‡πà‡∏°‡∏°‡∏≤ 8 ‡∏Ñ‡∏π‡πà‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏ö)
        const elementsPool = [
            { symbol: "H", name: "Hydrogen" }, { symbol: "He", name: "Helium" },
            { symbol: "Li", name: "Lithium" }, { symbol: "Be", name: "Beryllium" },
            { symbol: "B", name: "Boron" }, { symbol: "C", name: "Carbon" },
            { symbol: "N", name: "Nitrogen" }, { symbol: "O", name: "Oxygen" },
            { symbol: "F", name: "Fluorine" }, { symbol: "Ne", name: "Neon" },
            { symbol: "Na", name: "Sodium" }, { symbol: "Mg", name: "Magnesium" },
            { symbol: "Al", name: "Aluminium" }, { symbol: "Si", name: "Silicon" },
            { symbol: "P", name: "Phosphorus" }, { symbol: "S", name: "Sulfur" },
            { symbol: "Cl", name: "Chlorine" }, { symbol: "Ca", name: "Calcium" },
            { symbol: "Fe", name: "Iron" }, { symbol: "Cu", name: "Copper" }
        ];

        let cardsArray = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let totalPairs = 8;
        let timer = 0;
        let timerInterval;
        let isLocked = false;

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            setupBoard();
            timerInterval = setInterval(() => {
                timer++;
                document.getElementById('timer').innerText = timer;
            }, 1000);
        }

        function setupBoard() {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';
            
            // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 8 ‡∏ò‡∏≤‡∏ï‡∏∏
            const selectedElements = elementsPool.sort(() => 0.5 - Math.random()).slice(0, totalPairs);
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏Ñ‡∏π‡πà Symbol ‡πÅ‡∏•‡∏∞ Name)
            cardsArray = [];
            selectedElements.forEach(el => {
                cardsArray.push({ type: 'symbol', value: el.symbol, matchId: el.symbol });
                cardsArray.push({ type: 'name', value: el.name, matchId: el.symbol });
            });

            // ‡∏™‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î
            cardsArray.sort(() => 0.5 - Math.random());

            // Render
            cardsArray.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.id = index;
                card.dataset.matchId = item.matchId;
                
                // Font size adjustment for long names
                const fontSize = item.value.length > 3 ? 'text-sm' : 'text-3xl';
                
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">?</div>
                        <div class="card-back ${fontSize}">${item.value}</div>
                    </div>
                `;
                card.onclick = () => flipCard(card);
                grid.appendChild(card);
            });
            
            document.getElementById('pairs-left').innerText = totalPairs;
        }

        function flipCard(card) {
            if (isLocked || card.classList.contains('flipped') || card.classList.contains('matched')) return;

            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                checkMatch();
            }
        }

        function checkMatch() {
            isLocked = true;
            const [card1, card2] = flippedCards;

            if (card1.dataset.matchId === card2.dataset.matchId) {
                // Match!
                setTimeout(() => {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    flippedCards = [];
                    isLocked = false;
                    matchedPairs++;
                    document.getElementById('pairs-left').innerText = totalPairs - matchedPairs;
                    
                    if (matchedPairs === totalPairs) endGame();
                }, 600);
            } else {
                // Not Match
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    flippedCards = [];
                    isLocked = false;
                }, 1000);
            }
        }

        function endGame() {
            clearInterval(timerInterval);
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('final-time').innerText = timer;
        }

        function claimReward() {
            const btn = document.getElementById('claim-btn');
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•...";
            btn.disabled = true;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì XP: ‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏¢‡∏¥‡πà‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞ (Max 10)
            // < 30s = 10 XP, < 60s = 5 XP, else = 3 XP
            let xp = 3;
            if (timer < 30) xp = 10;
            else if (timer < 60) xp = 5;

            window.parent.postMessage({
                type: 'GAME_COMPLETE',
                game: 'periodic-match',
                score: timer, // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏¢‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ)
                xp: xp
            }, '*');
        }
    </script>
</body>
</html>