<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบสุ่มเลขที่และจัดกลุ่มนักเรียน</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4MQ3GL6CTB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4MQ3GL6CTB');
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f3f4f6;
            touch-action: manipulation; /* Improves touch response */
        }
        .animate-bounce-short {
            animation: bounce 0.5s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(0); }
        }
        .number-roll {
            transition: all 0.1s ease;
        }
        /* Custom Scrollbar for Group Grid */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-blue-50 to-indigo-100">

    <!-- Main Card -->
    <div class="bg-white w-full max-w-lg rounded-2xl shadow-xl overflow-hidden border border-gray-100">
        
        <!-- Header -->
        <div class="bg-indigo-600 p-6 text-center text-white">
            <h1 class="text-2xl font-bold"><i class="fa-solid fa-graduation-cap mr-2"></i>Random App</h1>
            <p class="text-indigo-100 text-sm mt-1">สุ่มเลขที่ & จัดกลุ่มกิจกรรม</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex border-b border-gray-200">
            <button onclick="switchTab('random')" id="tab-random" class="flex-1 py-4 text-center font-medium text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50 hover:bg-indigo-50 transition-colors">
                <i class="fa-solid fa-dice mr-1"></i> สุ่มเลขที่
            </button>
            <button onclick="switchTab('group')" id="tab-group" class="flex-1 py-4 text-center font-medium text-gray-500 hover:text-indigo-600 hover:bg-gray-50 transition-colors">
                <i class="fa-solid fa-users mr-1"></i> จับกลุ่ม
            </button>
        </div>

        <!-- Content Area -->
        <div class="p-6 min-h-[400px]">

            <!-- Section: Random Number -->
            <div id="content-random" class="block space-y-6">
                
                <!-- Inputs -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">เลขที่เริ่มต้น</label>
                        <input type="number" id="minVal" value="1" class="w-full border border-gray-300 rounded-lg p-2 text-center focus:ring-2 focus:ring-indigo-500 focus:outline-none text-lg">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">ถึงเลขที่</label>
                        <input type="number" id="maxVal" value="30" class="w-full border border-gray-300 rounded-lg p-2 text-center focus:ring-2 focus:ring-indigo-500 focus:outline-none text-lg">
                    </div>
                </div>

                <!-- Display Number -->
                <div class="flex justify-center items-center h-40 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-300 relative overflow-hidden">
                    <span id="resultDisplay" class="text-8xl font-bold text-gray-300 select-none">?</span>
                </div>

                <!-- Controls -->
                <div class="flex flex-col gap-3">
                    <button onclick="startRandom()" id="randomBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg transform active:scale-95 transition-all text-lg">
                        สุ่มเลขที่เลย!
                    </button>
                    
                    <div class="flex items-center justify-between px-2">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="noRepeat" class="form-checkbox h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
                            <span class="ml-2 text-gray-700 text-sm select-none">สุ่มไม่ซ้ำเลขเดิม</span>
                        </label>
                        <button onclick="resetHistory()" class="text-sm text-red-500 hover:text-red-700 underline">ล้างประวัติ</button>
                    </div>
                </div>

                <!-- History -->
                <div class="mt-4">
                    <p class="text-xs text-gray-500 mb-2">ประวัติการสุ่ม (ล่าสุด):</p>
                    <div id="historyList" class="flex flex-wrap gap-2 min-h-[30px]">
                        <!-- History items will appear here -->
                    </div>
                </div>
            </div>

            <!-- Section: Group Generator -->
            <div id="content-group" class="hidden space-y-5">
                
                <!-- Total Students -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">จำนวนนักเรียนทั้งหมด</label>
                    <input type="number" id="totalStudents" value="30" min="1" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>

                <!-- Group Settings -->
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <div class="flex gap-4 mb-3">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="groupMode" value="byGroupCount" checked onchange="toggleGroupInput()" class="text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-sm text-gray-700">ตามจำนวนกลุ่ม</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="groupMode" value="byPerGroup" onchange="toggleGroupInput()" class="text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-sm text-gray-700">ตามจำนวนคน/กลุ่ม</span>
                        </label>
                    </div>
                    
                    <div>
                        <label id="groupInputLabel" class="block text-xs text-gray-500 mb-1">ต้องการกี่กลุ่ม?</label>
                        <input type="number" id="groupValue" value="5" min="1" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                    </div>
                </div>

                <button onclick="generateGroups()" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-xl shadow-md transform active:scale-95 transition-all text-lg">
                    <i class="fa-solid fa-shuffle mr-2"></i>จับกลุ่ม
                </button>

                <!-- Results Area -->
                <div id="groupResults" class="grid grid-cols-2 gap-3 max-h-[300px] overflow-y-auto pb-2">
                    <!-- Cards will be injected here -->
                    <div class="col-span-2 text-center text-gray-400 py-8 text-sm">
                        กดปุ่มเพื่อเริ่มจับกลุ่ม
                    </div>
                </div>

            </div>

        </div>

        <!-- Footer -->
        <div class="bg-gray-50 p-3 text-center border-t border-gray-200">
            <p class="text-xs text-gray-400">ใช้งานง่าย ไม่ต้องติดตั้ง • ออกแบบเพื่อการศึกษาโดย KruBoat.com</p>
        </div>
    </div>

    <!-- Notification Modal (Simple Toast) -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none z-50 text-sm">
        ข้อความแจ้งเตือน
    </div>

    <script>
        // --- State Variables ---
        let pickedNumbers = [];
        let isAnimating = false;

        // --- Tabs Logic ---
        function switchTab(tab) {
            const randomBtn = document.getElementById('tab-random');
            const groupBtn = document.getElementById('tab-group');
            const contentRandom = document.getElementById('content-random');
            const contentGroup = document.getElementById('content-group');

            if (tab === 'random') {
                randomBtn.className = "flex-1 py-4 text-center font-medium text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50 transition-colors";
                groupBtn.className = "flex-1 py-4 text-center font-medium text-gray-500 hover:text-indigo-600 hover:bg-gray-50 transition-colors";
                contentRandom.classList.remove('hidden');
                contentGroup.classList.add('hidden');
            } else {
                groupBtn.className = "flex-1 py-4 text-center font-medium text-teal-600 border-b-2 border-teal-600 bg-teal-50 transition-colors";
                randomBtn.className = "flex-1 py-4 text-center font-medium text-gray-500 hover:text-teal-600 hover:bg-gray-50 transition-colors";
                contentRandom.classList.add('hidden');
                contentGroup.classList.remove('hidden');
            }
        }

        // --- Random Number Logic ---
        function startRandom() {
            if (isAnimating) return;

            const min = parseInt(document.getElementById('minVal').value);
            const max = parseInt(document.getElementById('maxVal').value);
            const noRepeat = document.getElementById('noRepeat').checked;
            const display = document.getElementById('resultDisplay');
            const historyDiv = document.getElementById('historyList');

            // Validation
            if (min >= max) {
                showToast("ตัวเลขเริ่มต้นต้องน้อยกว่าตัวเลขสิ้นสุด");
                return;
            }

            // Calculate available numbers
            let available = [];
            for (let i = min; i <= max; i++) {
                if (!noRepeat || !pickedNumbers.includes(i)) {
                    available.push(i);
                }
            }

            if (available.length === 0) {
                showToast("สุ่มครบทุกเลขแล้ว! กรุณาล้างประวัติ");
                return;
            }

            // Start Animation
            isAnimating = true;
            document.getElementById('randomBtn').disabled = true;
            document.getElementById('randomBtn').classList.add('opacity-50', 'cursor-not-allowed');
            
            display.classList.remove('text-indigo-600', 'text-gray-300');
            display.classList.add('text-gray-800');

            let counter = 0;
            const interval = setInterval(() => {
                const tempRand = Math.floor(Math.random() * (max - min + 1)) + min;
                display.innerText = tempRand;
                counter++;
                if (counter > 15) { // Stop after ~1.5 seconds (15 * 100ms)
                    clearInterval(interval);
                    finalizeRandom(available);
                }
            }, 80);
        }

        function finalizeRandom(availableOptions) {
            const display = document.getElementById('resultDisplay');
            const historyDiv = document.getElementById('historyList');
            
            // Pick final number
            const randomIndex = Math.floor(Math.random() * availableOptions.length);
            const finalNumber = availableOptions[randomIndex];

            // Update State
            pickedNumbers.push(finalNumber);

            // Update UI
            display.innerText = finalNumber;
            display.classList.add('text-indigo-600');
            display.classList.remove('text-gray-800');
            
            // Add bounce effect
            display.parentElement.classList.add('scale-110', 'border-indigo-400');
            setTimeout(() => {
                display.parentElement.classList.remove('scale-110', 'border-indigo-400');
            }, 300);

            // Add to history
            const badge = document.createElement('span');
            badge.className = "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 animate-pulse";
            badge.innerText = finalNumber;
            historyDiv.prepend(badge);
            
            // Remove animation class after a bit
            setTimeout(() => badge.classList.remove('animate-pulse'), 1000);

            // Reset Controls
            isAnimating = false;
            document.getElementById('randomBtn').disabled = false;
            document.getElementById('randomBtn').classList.remove('opacity-50', 'cursor-not-allowed');
        }

        function resetHistory() {
            pickedNumbers = [];
            document.getElementById('historyList').innerHTML = '';
            document.getElementById('resultDisplay').innerText = '?';
            document.getElementById('resultDisplay').classList.remove('text-indigo-600');
            document.getElementById('resultDisplay').classList.add('text-gray-300');
            showToast("ล้างประวัติเรียบร้อย");
        }

        // --- Group Logic ---
        function toggleGroupInput() {
            const mode = document.querySelector('input[name="groupMode"]:checked').value;
            const label = document.getElementById('groupInputLabel');
            if (mode === 'byGroupCount') {
                label.innerText = "ต้องการกี่กลุ่ม?";
            } else {
                label.innerText = "ต้องการกลุ่มละกี่คน?";
            }
        }

        function generateGroups() {
            const total = parseInt(document.getElementById('totalStudents').value);
            const val = parseInt(document.getElementById('groupValue').value);
            const mode = document.querySelector('input[name="groupMode"]:checked').value;
            const resultsDiv = document.getElementById('groupResults');

            if (total < 1 || val < 1) {
                showToast("กรุณากรอกตัวเลขให้ถูกต้อง");
                return;
            }
            if (val > total && mode === 'byPerGroup') {
                 showToast("จำนวนคนต่อกลุ่มมากกว่าจำนวนนักเรียนทั้งหมด");
                 return;
            }

            // Generate Student Array [1, 2, ..., total]
            let students = Array.from({length: total}, (_, i) => i + 1);
            
            // Shuffle (Fisher-Yates)
            for (let i = students.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [students[i], students[j]] = [students[j], students[i]];
            }

            let groups = [];
            
            if (mode === 'byGroupCount') {
                // Logic: Divide into N groups
                const numGroups = val;
                if (numGroups > total) {
                     showToast("จำนวนกลุ่มมากกว่าจำนวนนักเรียน");
                     return;
                }
                
                for (let i = 0; i < numGroups; i++) {
                    groups.push([]);
                }
                
                // Distribute
                students.forEach((student, index) => {
                    groups[index % numGroups].push(student);
                });

            } else {
                // Logic: N students per group
                const perGroup = val;
                for (let i = 0; i < students.length; i += perGroup) {
                    groups.push(students.slice(i, i + perGroup));
                }
            }

            // Render Results
            resultsDiv.innerHTML = '';
            groups.forEach((group, index) => {
                const card = document.createElement('div');
                card.className = "bg-white border border-gray-200 rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow";
                
                const title = document.createElement('h3');
                title.className = "text-teal-600 font-bold text-sm mb-2 border-b border-gray-100 pb-1";
                title.innerHTML = `<i class="fa-solid fa-users-viewfinder mr-1"></i>กลุ่มที่ ${index + 1}`;
                
                const content = document.createElement('div');
                content.className = "text-gray-600 text-sm leading-relaxed font-mono";
                // Sort numbers within the group for readability
                group.sort((a, b) => a - b);
                content.innerText = group.join(", ");

                card.appendChild(title);
                card.appendChild(content);
                resultsDiv.appendChild(card);
            });
            
            // Layout fix for single result
            if (groups.length === 1) {
                resultsDiv.firstElementChild.classList.add('col-span-2');
            }
        }

        // --- Utility ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.classList.remove('opacity-0');
            setTimeout(() => {
                toast.classList.add('opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>