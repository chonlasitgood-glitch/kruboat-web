<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Logic Robot: ฝึกคิดแบบอัลกอริทึม</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4MQ3GL6CTB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4MQ3GL6CTB');
    </script>

    <!-- ใช้ Tailwind CSS สำหรับตกแต่ง -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ใช้ Font Awesome สำหรับไอคอน -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #1a202c;
            color: white;
            /* ป้องกัน Zoom บนมือถือ */
            touch-action: manipulation; 
        }

        .grid-cell {
            transition: all 0.3s ease;
        }

        /* หุ่นยนต์ */
        #robot {
            transition: transform 0.5s ease-in-out, top 0.5s ease-in-out, left 0.5s ease-in-out;
            z-index: 10;
        }

        /* เอฟเฟกต์ตอนกดปุ่ม */
        .btn-press:active {
            transform: scale(0.95);
        }

        /* Scrollbar สำหรับรายการคำสั่ง */
        .command-list::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .command-list::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        
        /* ปรับแต่ง Scrollbar หลักสำหรับ Container บนมือถือ */
        #main-container::-webkit-scrollbar {
            width: 8px;
        }
        #main-container::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
    </style>
</head>
<!-- ปรับ body ให้เป็น flex column และ overflow-hidden เฉพาะบนจอใหญ่ -->
<body class="h-screen w-full flex flex-col items-center bg-gray-900 overflow-hidden">

    <!-- Header: Fixed Height -->
    <div class="w-full max-w-4xl px-4 py-3 flex-none flex justify-between items-center bg-gray-800 shadow-md z-10 border-b border-gray-700">
        <h1 class="text-lg md:text-2xl font-bold text-green-400 truncate"><i class="fas fa-robot mr-2"></i>Logic Robot</h1>
        <div class="flex gap-3 flex-shrink-0">
            <span class="text-gray-300 text-sm md:text-base flex items-center bg-gray-700 px-3 py-1 rounded-full">
                ด่าน: <span id="level-display" class="font-bold text-white ml-1">1</span>/15
            </span>
            <button onclick="resetLevel()" class="text-red-400 hover:text-red-300 text-sm md:text-base px-2">
                <i class="fas fa-rotate-right"></i>
            </button>
        </div>
    </div>

    <!-- Main Content: Scrollable on mobile (overflow-y-auto), Locked on Desktop (md:overflow-hidden) -->
    <div id="main-container" class="w-full max-w-4xl flex-grow flex flex-col md:flex-row gap-4 p-4 overflow-y-auto md:overflow-hidden">
        
        <!-- ส่วนแสดงผลเกม (Game Board): ย่อขยายได้ -->
        <div class="flex-none md:flex-grow flex flex-col items-center justify-center bg-gray-800 rounded-xl border-2 border-gray-700 relative p-4 min-h-[350px] md:min-h-0 shadow-lg" id="game-container">
            <!-- Grid จะถูกสร้างโดย JavaScript -->
            <div id="grid-board" class="relative transition-all shadow-2xl"></div>
            
            <!-- Overlay แจ้งเตือน -->
            <div id="message-modal" class="hidden absolute inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center z-50 rounded-xl p-4 text-center backdrop-blur-sm">
                <i id="modal-icon" class="fas fa-check-circle text-6xl text-green-500 mb-4 animate-bounce"></i>
                <h2 id="modal-title" class="text-3xl font-bold mb-2 text-green-400">สำเร็จ!</h2>
                <p id="modal-text" class="mb-6 text-gray-300 px-4">คุณเขียนโปรแกรมได้ถูกต้อง</p>
                <button id="modal-btn" onclick="nextLevel()" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-full transition shadow-[0_0_15px_rgba(34,197,94,0.5)] active:scale-95 text-lg">
                    ด่านถัดไป <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- ส่วนควบคุม (Controls): อยู่ล่างสุดบนมือถือ -->
        <div class="flex-none w-full md:w-80 flex flex-col gap-3 bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-xl pb-8 md:pb-4">
            
            <!-- หน้าจอแสดงคำสั่ง -->
            <div class="bg-black/40 rounded-lg p-3 border border-gray-600 flex flex-col h-[180px] md:h-auto md:flex-grow">
                <div class="flex justify-between items-center mb-2 border-b border-gray-700 pb-2">
                    <span class="text-xs text-blue-400 uppercase tracking-widest font-bold"><i class="fas fa-code mr-1"></i> Program</span>
                    <span id="command-count" class="text-xs text-gray-400 bg-gray-700 px-2 py-0.5 rounded">0/30</span>
                </div>
                <div id="command-list" class="command-list flex flex-wrap content-start gap-2 overflow-y-auto h-full pr-1">
                    <!-- คำสั่งจะมาโผล่ตรงนี้ -->
                    <div class="text-gray-500 text-sm italic w-full text-center mt-8 empty-msg flex flex-col items-center opacity-50">
                        <i class="fas fa-hand-pointer mb-2 text-2xl"></i>
                        เลือกคำสั่งด้านล่าง
                    </div>
                </div>
            </div>

            <!-- ปุ่มควบคุม -->
            <div class="grid grid-cols-4 gap-2">
                <button onclick="addCommand('L')" class="btn-press bg-blue-600 hover:bg-blue-500 active:bg-blue-700 p-3 rounded-lg shadow-md flex flex-col items-center justify-center h-16 border-b-4 border-blue-800 active:border-b-0 active:translate-y-1 transition-all">
                    <i class="fas fa-undo text-white text-lg mb-1"></i>
                    <span class="text-[10px] font-bold">หันซ้าย</span>
                </button>
                <button onclick="addCommand('F')" class="btn-press bg-green-600 hover:bg-green-500 active:bg-green-700 p-3 rounded-lg shadow-md flex flex-col items-center justify-center col-span-2 h-16 border-b-4 border-green-800 active:border-b-0 active:translate-y-1 transition-all">
                    <i class="fas fa-arrow-up text-white text-xl mb-1"></i>
                    <span class="text-[10px] font-bold">เดินหน้า</span>
                </button>
                <button onclick="addCommand('R')" class="btn-press bg-blue-600 hover:bg-blue-500 active:bg-blue-700 p-3 rounded-lg shadow-md flex flex-col items-center justify-center h-16 border-b-4 border-blue-800 active:border-b-0 active:translate-y-1 transition-all">
                    <i class="fas fa-redo text-white text-lg mb-1"></i>
                    <span class="text-[10px] font-bold">หันขวา</span>
                </button>
            </div>

            <div class="grid grid-cols-2 gap-2 mt-1">
                <button onclick="clearCommands()" class="btn-press bg-red-900/50 hover:bg-red-900 text-red-300 py-3 rounded-lg border border-red-800 text-sm font-bold flex items-center justify-center transition-colors">
                    <i class="fas fa-trash mr-2"></i> ล้าง
                </button>
                <button id="run-btn" onclick="runProgram()" class="btn-press bg-yellow-500 hover:bg-yellow-400 active:bg-yellow-600 text-gray-900 font-bold py-3 rounded-lg shadow-lg text-sm flex items-center justify-center gap-2 border-b-4 border-yellow-700 active:border-b-0 active:translate-y-1 transition-all">
                    <i class="fas fa-play"></i> เริ่มทำงาน
                </button>
            </div>
        </div>
    </div>

    <!-- Script หลักของเกม -->
    <script>
        // --- 1. การตั้งค่าและตัวแปรหลัก ---
        let boardSize = 40; // เริ่มต้นเล็กลงหน่อยเผื่อมือถือ
        const gapSize = 3;  
        
        let currentLevel = 0;
        let robotState = { x: 0, y: 0, dir: 1 };
        let isRunning = false;
        let commands = [];
        const maxCommands = 30;
        
        const levels = [
            { map: [[0, 0, 0, 0, 0], [2, 0, 0, 3, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0], [0, 0, 0, 0, 0]], startDir: 1, hint: "Level 1: เดินหน้าตรงไปเลย!" },
            { map: [[0, 0, 0, 3, 0], [0, 1, 1, 0, 0], [2, 0, 0, 0, 0], [0, 1, 1, 1, 0], [0, 0, 0, 0, 0]], startDir: 1, hint: "Level 2: เลี้ยวซ้ายเพื่อหลบกำแพง" },
            { map: [[0, 0, 1, 3, 0], [0, 0, 1, 0, 0], [0, 0, 1, 0, 0], [0, 2, 0, 0, 1], [0, 1, 1, 1, 1]], startDir: 0, hint: "Level 3: ซิกแซกไปตามทาง" },
            { map: [[3, 0, 0, 0, 0], [1, 1, 1, 1, 0], [0, 0, 0, 0, 0], [0, 1, 1, 1, 1], [2, 0, 0, 0, 0]], startDir: 1, hint: "Level 4: เดินอ้อมกำแพงเป็นตัว U" },
            { map: [[1, 1, 3, 1, 1], [1, 0, 0, 0, 1], [1, 0, 1, 0, 1], [1, 0, 0, 0, 1], [1, 1, 2, 1, 1]], startDir: 0, hint: "Level 5: ทางแยกวัดใจ เลือกซ้ายหรือขวา?" },
            { map: [[2, 0, 0, 0, 0, 0], [1, 1, 0, 0, 0, 0], [0, 1, 1, 0, 0, 0], [0, 0, 1, 1, 0, 0], [0, 0, 0, 1, 1, 0], [0, 0, 0, 0, 1, 3]], startDir: 1, hint: "Level 6: เดินลงบันได ระวังตกขอบ!" },
            { map: [[1, 1, 1, 1, 1], [1, 0, 0, 0, 1], [1, 0, 1, 0, 1], [1, 0, 3, 0, 1], [2, 0, 0, 0, 1]], startDir: 1, hint: "Level 7: ก้นหอยมรณะ" },
            { map: [[0, 0, 0, 1, 3, 0], [0, 1, 0, 1, 1, 0], [0, 1, 0, 0, 0, 0], [0, 1, 1, 1, 1, 0], [0, 0, 0, 0, 0, 0], [2, 1, 1, 1, 1, 0]], startDir: 0, hint: "Level 8: หาช่องว่างให้เจอ" },
            { map: [[1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 1, 0, 0, 1], [1, 1, 0, 1, 0, 1, 1], [1, 0, 0, 0, 0, 0, 1], [1, 0, 1, 1, 1, 0, 1], [1, 0, 0, 0, 1, 3, 1], [1, 1, 1, 1, 1, 1, 1]], startDir: 1, hint: "Level 9: อย่าหลงทางในเขาวงกต" },
            { map: [[2, 0, 0, 0, 0, 1, 0], [1, 1, 1, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0], [0, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 3]], startDir: 1, hint: "Level 10: อ้อมโลกไปให้ถึงฝัน" },
            { map: [[1, 1, 1, 1, 1, 1], [1, 2, 0, 1, 3, 1], [1, 0, 0, 1, 0, 1], [1, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1]], startDir: 2, hint: "Level 11: ต้องถอยหลังกลับหรือเปล่านะ?" },
            { map: [[2, 1, 0, 1, 0, 1, 3], [0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0]], startDir: 2, hint: "Level 12: หลบหลีกสิ่งกีดขวางแบบดิจิทัล" },
            { map: [[0, 0, 1, 0, 0, 1, 0], [2, 0, 1, 0, 0, 1, 3], [0, 0, 1, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0]], startDir: 1, hint: "Level 13: หาทางข้ามกำแพงยาว" },
            { map: [[2, 0, 1, 0, 0], [1, 0, 1, 0, 1], [1, 0, 0, 0, 1], [1, 0, 1, 0, 1], [0, 0, 1, 3, 0]], startDir: 1, hint: "Level 14: ตัว H เจ้าปัญหา" },
            { map: [[1, 1, 1, 1, 1, 1, 1, 1], [1, 2, 0, 0, 0, 0, 0, 1], [1, 1, 1, 0, 1, 1, 0, 1], [1, 0, 0, 0, 1, 3, 0, 1], [1, 0, 1, 1, 1, 1, 1, 1], [1, 0, 0, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1, 1, 1]], startDir: 1, hint: "Level 15: ด่านสุดท้าย! ขอให้โชคดี" }
        ];

        // --- 2. ฟังก์ชันเริ่มเกมและการวาดกระดาน ---
        
        function initGame() {
            renderBoard();
            updateUI();
            window.addEventListener('resize', renderBoard); // ปรับขนาดเมื่อหมุนจอหรือเปลี่ยนขนาด
        }

        function renderBoard() {
            const levelData = levels[currentLevel];
            const map = levelData.map;
            const rows = map.length;
            const cols = map[0].length;
            
            // คำนวณขนาดบอร์ดให้พอดีกับ Container
            const container = document.getElementById('game-container');
            // ใช้ขนาดที่เล็กกว่าระหว่างความกว้างและความสูง
            // ลบ padding ออกหน่อย
            const maxW = container.clientWidth - 32; 
            // บนมือถือเราอยากให้เห็นบอร์ดเต็มๆ แต่ไม่กินที่ปุ่ม
            // บน PC ให้สูงได้
            const isMobile = window.innerWidth < 768;
            const maxH = isMobile ? 300 : container.clientHeight - 32;

            const sizeByW = Math.floor(maxW / cols);
            const sizeByH = Math.floor(maxH / rows);
            
            // เลือกค่าที่น้อยกว่าเพื่อให้พอดี และไม่เกิน 50px
            boardSize = Math.min(sizeByW, sizeByH, 50);
            
            // ป้องกันเล็กเกินไปจนมองไม่เห็น
            if(boardSize < 25) boardSize = 25;

            const gridBoard = document.getElementById('grid-board');
            gridBoard.innerHTML = '';
            
            gridBoard.style.display = 'grid';
            gridBoard.style.gridTemplateColumns = `repeat(${cols}, ${boardSize}px)`;
            gridBoard.style.gridTemplateRows = `repeat(${rows}, ${boardSize}px)`;
            gridBoard.style.gap = `${gapSize}px`;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const cellVal = map[r][c];
                    const cell = document.createElement('div');
                    cell.className = 'w-full h-full rounded-sm md:rounded flex items-center justify-center relative';
                    
                    if (cellVal === 1) { // กำแพง
                        cell.className += ' bg-gray-600 border border-gray-500 shadow-inner';
                        cell.innerHTML = '<i class="fas fa-cube text-gray-400 text-[50%]"></i>';
                    } else if (cellVal === 3) { // เป้าหมาย
                        cell.className += ' bg-gray-700/50 border border-gray-600';
                        cell.innerHTML = '<i class="fas fa-bolt text-yellow-400 text-[60%] animate-pulse drop-shadow-[0_0_5px_rgba(250,204,21,0.8)]"></i>';
                    } else { // ทางเดิน
                        cell.className += ' bg-gray-800 border border-gray-700';
                        const dot = document.createElement('div');
                        dot.className = 'w-1 h-1 bg-gray-700 rounded-full';
                        cell.appendChild(dot);
                    }
                    
                    if (cellVal === 2) { 
                        robotState.x = c;
                        robotState.y = r;
                    }
                    
                    cell.id = `cell-${c}-${r}`;
                    gridBoard.appendChild(cell);
                }
            }

            const robot = document.createElement('div');
            robot.id = 'robot';
            robot.className = 'absolute flex items-center justify-center text-green-400 drop-shadow-lg z-20 pointer-events-none';
            robot.style.width = `${boardSize}px`;
            robot.style.height = `${boardSize}px`;
            // ใช้ SVG หรือ icon ที่คมชัด
            robot.innerHTML = '<i class="fas fa-robot text-[70%] filter drop-shadow-md"></i>';
            
            gridBoard.appendChild(robot);
            
            robotState.dir = levelData.startDir;
            updateRobotVisual();
        }

        function updateRobotVisual() {
            const robot = document.getElementById('robot');
            const left = robotState.x * (boardSize + gapSize);
            const top = robotState.y * (boardSize + gapSize);
            const rotation = (robotState.dir) * 90; 

            robot.style.transform = `translate(${left}px, ${top}px) rotate(${rotation}deg)`;
            robot.style.width = `${boardSize}px`;
            robot.style.height = `${boardSize}px`;
        }
        
        function updateUI() {
             document.getElementById('level-display').innerText = currentLevel + 1;
             clearCommands();
        }

        // --- 3. ระบบคำสั่ง (Logic) ---

        function addCommand(cmd) {
            if (isRunning) return;
            if (commands.length >= maxCommands) return; 

            commands.push(cmd);
            renderCommandList();
            
            // สั่นเล็กน้อยเมื่อกดปุ่ม (สำหรับมือถือ)
            if (navigator.vibrate) navigator.vibrate(10);
        }

        function clearCommands() {
            if (isRunning) return;
            commands = [];
            renderCommandList();
        }

        function renderCommandList() {
            const listEl = document.getElementById('command-list');
            const countEl = document.getElementById('command-count');
            
            listEl.innerHTML = ''; 

            if (commands.length === 0) {
                 listEl.innerHTML = `
                    <div class="text-gray-500 text-sm italic w-full text-center mt-8 empty-msg flex flex-col items-center opacity-50">
                        <i class="fas fa-hand-pointer mb-2 text-2xl animate-bounce"></i>
                        เลือกคำสั่งด้านล่าง
                    </div>`;
            } else {
                commands.forEach((cmd, index) => {
                    const item = document.createElement('div');
                    item.className = 'w-9 h-9 md:w-10 md:h-10 rounded-md flex items-center justify-center text-sm font-bold shadow-sm cursor-pointer hover:bg-red-500 hover:text-white transition transform hover:scale-105 border-b-2 active:border-b-0 active:translate-y-[2px]';
                    
                    if (cmd === 'F') {
                        item.classList.add('bg-green-700', 'text-white', 'border-green-900', 'border');
                        item.innerHTML = '<i class="fas fa-arrow-up"></i>';
                    } else if (cmd === 'L') {
                        item.classList.add('bg-blue-700', 'text-white', 'border-blue-900', 'border');
                        item.innerHTML = '<i class="fas fa-undo"></i>';
                    } else if (cmd === 'R') {
                        item.classList.add('bg-blue-700', 'text-white', 'border-blue-900', 'border');
                        item.innerHTML = '<i class="fas fa-redo"></i>';
                    }
                    
                    item.onclick = () => {
                        if(!isRunning) {
                            commands.splice(index, 1);
                            renderCommandList();
                        }
                    };
                    
                    listEl.appendChild(item);
                });
            }
            
            countEl.innerText = `${commands.length}/${maxCommands}`;
            listEl.scrollTop = listEl.scrollHeight;
        }

        // --- 4. การทำงานของโปรแกรม ---

        async function runProgram() {
            if (isRunning || commands.length === 0) return;
            
            isRunning = true;
            const runBtn = document.getElementById('run-btn');
            const originalContent = runBtn.innerHTML;
            
            runBtn.classList.add('opacity-70', 'cursor-not-allowed');
            runBtn.innerHTML = '<i class="fas fa-cog fa-spin"></i>';

            resetRobotToStart();
            await sleep(500);

            for (let i = 0; i < commands.length; i++) {
                if (!isRunning) break; 

                const cmd = commands[i];
                highlightCommand(i); 
                
                await executeCommand(cmd);
                
                const result = checkWinCondition();
                if (result === 'win') {
                    showModal(true);
                    isRunning = false;
                    resetBtnState(originalContent);
                    return;
                } else if (result === 'crash') {
                    showModal(false, 'หุ่นยนต์ชนกำแพง!');
                    isRunning = false;
                    resetBtnState(originalContent);
                    return;
                } else if (result === 'out') {
                    showModal(false, 'หุ่นยนต์หลุดออกนอกแผนที่!');
                    isRunning = false;
                    resetBtnState(originalContent);
                    return;
                }

                await sleep(400); 
            }

            if (isRunning) {
                 showModal(false, 'โปรแกรมจบแล้ว แต่ยังไม่ถึงเป้าหมาย');
                 isRunning = false;
                 resetBtnState(originalContent);
            }
        }

        async function executeCommand(cmd) {
            if (cmd === 'F') { 
                const nextX = robotState.x + (robotState.dir === 1 ? 1 : robotState.dir === 3 ? -1 : 0);
                const nextY = robotState.y + (robotState.dir === 2 ? 1 : robotState.dir === 0 ? -1 : 0);
                robotState.x = nextX;
                robotState.y = nextY;
            } else if (cmd === 'L') { 
                robotState.dir = (robotState.dir + 3) % 4; 
            } else if (cmd === 'R') { 
                robotState.dir = (robotState.dir + 1) % 4;
            }
            updateRobotVisual();
        }

        function checkWinCondition() {
            const map = levels[currentLevel].map;
            const r = robotState.y;
            const c = robotState.x;

            if (r < 0 || r >= map.length || c < 0 || c >= map[0].length) return 'out';
            if (map[r][c] === 1) return 'crash';
            if (map[r][c] === 3) return 'win';

            return 'continue';
        }

        function resetRobotToStart() {
            const levelData = levels[currentLevel];
            const map = levelData.map;
            for (let r = 0; r < map.length; r++) {
                for (let c = 0; c < map[0].length; c++) {
                    if (map[r][c] === 2) {
                        robotState.x = c;
                        robotState.y = r;
                    }
                }
            }
            robotState.dir = levelData.startDir;
            updateRobotVisual();
        }

        function resetLevel() {
            isRunning = false;
            resetBtnState('<i class="fas fa-play"></i> เริ่มทำงาน');
            clearCommands();
            resetRobotToStart();
            document.getElementById('message-modal').classList.add('hidden');
        }

        function nextLevel() {
            currentLevel++;
            if (currentLevel >= levels.length) {
                currentLevel = 0; 
                alert("ยินดีด้วย! คุณผ่านครบทั้ง 15 ด่านแล้ว! กลับไปเริ่มด่าน 1 ใหม่นะ");
            }
            resetLevel(); 
            initGame();
        }

        function showModal(isSuccess, message) {
            const modal = document.getElementById('message-modal');
            const title = document.getElementById('modal-title');
            const text = document.getElementById('modal-text');
            const btn = document.getElementById('modal-btn');
            const icon = document.getElementById('modal-icon');

            modal.classList.remove('hidden');
            
            if (isSuccess) {
                title.innerText = "ภารกิจสำเร็จ!";
                title.className = "text-3xl font-bold mb-2 text-green-400";
                icon.className = "fas fa-check-circle text-6xl text-green-500 mb-4 animate-bounce";
                text.innerText = "สุดยอดมาก! ไปด่านต่อไปกันเลย";
                btn.innerHTML = 'ด่านถัดไป <i class="fas fa-arrow-right ml-2"></i>';
                btn.className = "bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-full transition shadow-lg";
                btn.onclick = nextLevel;
                // Play success sound logic here if wanted
            } else {
                title.innerText = "ล้มเหลว";
                title.className = "text-3xl font-bold mb-2 text-red-400";
                icon.className = "fas fa-times-circle text-6xl text-red-500 mb-4 animate-pulse";
                text.innerText = message || "ลองตรวจสอบคำสั่งดูใหม่อีกครั้งนะ";
                btn.innerText = "ลองใหม่";
                btn.className = "bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-8 rounded-full transition shadow-lg";
                btn.onclick = () => {
                     modal.classList.add('hidden');
                     resetRobotToStart(); 
                };
            }
        }

        function highlightCommand(index) {
            const listEl = document.getElementById('command-list');
            const items = listEl.children;
            for(let item of items) {
                item.style.opacity = '0.5';
                item.style.transform = 'scale(1)';
                item.style.borderColor = 'transparent';
            }
            if(items[index]) {
                items[index].style.opacity = '1';
                items[index].style.transform = 'scale(1.1)';
                items[index].style.borderColor = 'yellow';
            }
        }

        function resetBtnState(originalContent) {
            const btn = document.getElementById('run-btn');
            btn.classList.remove('opacity-70', 'cursor-not-allowed');
            btn.innerHTML = originalContent || '<i class="fas fa-play"></i> เริ่มทำงาน';
            
            const listEl = document.getElementById('command-list');
            for(let item of listEl.children) {
                item.style.opacity = '1';
                item.style.transform = '';
                item.style.borderColor = '';
            }
        }

        const sleep = (ms) => new Promise(r => setTimeout(r, ms));

        window.onload = initGame;

    </script>
</body>
</html>